---
title: Varnishhist
layout: post
tags:
  - varnish
  - highload
image: /assets/images/covers/varnish.jpg
show_on_main: 1
---

**Varnishhist** - Это консольная утилита отображающая гистограмму последних n запросов к Varnish. 

<img class="img-responsive" src="/assets/images/posts/varnishhist.png">
<br>

Символом « **|** » обозначаются попадания в кеш (cache_hit). 

Символом « **#** » обозначаются промахи (cache miss) обращения. В случае промоха идет обращение на бекенд.

По оси абсцисс расположена логорифмическая шкала дельты времени с основанием 10 между запросом и ответом. 
Запись вида 1e-6 = 1 \* 10<sup>-6</sup> = 0.000001 с = 1 мкс.  

Данная гистограмма позволяет визуально:

- оценить производительность кеша на протяжении времени;
- сравнить скорость ответа кеша и бекенда;
- понять правильно ли написан конфиг, оценив баланс между попаданиями и промахами.

На вышеприведенной гистрограмме был проведен небольшой тест с помощью [yandex-tank](https://tech.yandex.ru/tank/). 
Произведена линейная нагрузка с 300 до 1000 rps. Левый кластер из « | » - отдача из кеша, 
средний кластер из « # » запросы, которые не кешируются и правый кластер из « | » - прогрев кеша. 

