---
title: Varnishhist
layout: post
tags:
  - varnish
  - highload
image: /assets/images/covers/varnish.jpg
---

**Varnishhist** - это консольная утилита, отображающая гистограмму распределения последних n запросов к Varnish. 

<img class="img-responsive" src="/assets/images/posts/varnishhist.png">
<br>

Символ « **|** » обозначает попадания в кэш (cache_hit). 

Символ « **#** » обозначает промах (cache miss). В случае промаха идет обращение на бэкенд.

По оси абсцисс расположена логорифмическая шкала дельты времени с основанием 10 между запросом и ответом. 
Запись вида 1e-6 = 1 \* 10<sup>-6</sup> = 0.000001 с = 1 мкс.  

Данная гистограмма позволяет визуально:

- оценить производительность кэша на протяжении времени;
- сравнить скорость ответа кэша и бэкенда;
- понять правильно ли написан конфиг, оценив баланс между попаданиями и промахами.

На вышеприведенной гистограмме был проведен небольшой тест с помощью [yandex-tank](https://tech.yandex.ru/tank/). 
Произведена линейная нагрузка с 300 до 1000 rps. Левый кластер из « | » - отдача из кэша, 
средний кластер из « # » запросы, которые не кэшируются и правый кластер из « | » - прогрев кэша. 

